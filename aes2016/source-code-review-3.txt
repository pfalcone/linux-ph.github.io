Election System Code Review (3) — Deployment
============================================
Wilhansen Li, 21 April 2016

The source code of the election system isn’t everything. It has to be deployed to devices to be usable. Unlike Facebook (and other internet services) which is 100% software, it’s not simply installed to a fully-controlled server and run: parts of the system must be securely installed on at least 95,000 hardware, each with a unique set of configuration, and then transported. The hardware component makes things more complicated.

The overall process from source code to the usable system goes something like this (not very comprehensive):

1. The source code of the election system (VCM, CCS, and EMS) must be compiled. That is, it’s turned from something human-readable to something that computers can execute. Alongside with this is compiling the operating system (it’s not running on Windows) that the VCM runs on.
2. The configuration for each VCM must be generated by the EMS, and the ballot templates generated.
3. Ballots must be printed, taking great care than the exact number of them are printed. No more, no less.
4. The configuration for each VCM, together with the BEI certificates, must be loaded into the SD Card
5. The operating system, together with the election program, must be installed into the VCM.
6. Three iButtons used by the BEI must be associated to the certificates in the VCM, taking care not to mix them up.
7. The VCMs must be packed with their accessories: pens, headphones, paper roles, iButtons, cleaning sheets, test ballots, 3G/HSDPA modems + SIM cards (if needed), and passwords/instructions.
8. The CCS software must be installed and configured on the laptops they run on.
9. The devices must be shipped to the polling centers, together with any additional networking devices (Satellite receivers, modems, etc.).
10. The network must be set up and the VCMs and CCSs could connect to it. No one unauthorized should be able to even access the network.
11. After the election, the SD cards, which stores the log of what the machine has done, together with the scanned images of the ballots, must be stored securely.

There’s a chance of infiltration at every step:
* what if someone managed to insert unauthorized code before building?
* what if the configurations are tampered?
* what if someone stole the SD cards/VCMs?
* what about hackers attacking the system since it’s online?

While I cannot cover everything (e.g., managing personnel to prevent them from sneaking anything out), I could describe the measures being done for the more technical ones.

Compilation
-----------

Throughout the source code review process, the “fingerprint” of the source codes, called the hash (about 64 letters long), is noted. When any part of the source code changes, no matter how small, the hash changes. So instead of scouring through all files (at least 2,000 of them) to check for possible tampering or changes, we just need to look at the hash, which is more manageable.

The compilation process is a public event. All political parties could witness it to make sure nothing suspicious happens. Before the source code is compiled, its hash is computed and checked if it matches the hash that was previously noted in order to certify that the code that was reviewed is indeed the same code that is going to be compiled. The output of this “certified, public-witnessed compilation” process is what we call the Trusted Build.

Aside: Ballots
--------------
All ballots have a bar code which indicates:
* The precinct it belongs to
* Whether the ballot is a test ballot
* If it’s the front or back (so the back of the ballot has a different barcode)

The blank area between the header and the list of candidates on both sides should NEVER BE MARKED. Doing so will invalidate your ballot. It is there in order to check if the VCM scanner is dirty. 
I might add more details here as they come across my mind.

Assembly Process
----------------

The VCMs are manufactured outside of the country (Taiwan if my memory serves me right), then brought to Laguna to be configured. They put safeguards to make sure that their personnel didn’t bring anything unnecessary in or out of the VCM assembly warehouse. Throughout the assembly process, each COMELEC personnel who do the procedures is accompanied by a Smartmatic personnel for QA.
As for the actual process of configuring the VCM:
1. Test ballots printed by the National Printing Office are sent to the assembly warehouse. These serve as the “control” of the process since the precinct number is coded in them.
2. The EMS generates the municipal SD card data which contains the configuration data (which dictates the candidates that could be voted among others) and BEI certificates  of all the precincts under it. So if there are 21 precincts under in a municipal, it contains 21 different configuration data and 21 * 3 - 63 BEI certificates.
3. The municipal SD card data is replicated to SD cards for the precincts, two for each precincts (main and backup).
4. Meanwhile, the test ballots are shaded/voted on randomly (so some of them has Miriam for President, Grace, etc. so does the rest of the positions).
5. The test ballot is inserted to a scanner which detects the precinct number and generates labels for the SD cards (the main and backup have different color and labels) and iButton, and password sheets.
6. The SD cards, iButtons, password sheets, and test ballots are then packed together and sent to the VCM assembly room. Let’s call this the data pack.
7. The COMELEC personnel receives the VCM and the data pack. The personnel inserts the test ballot on the VCM which then locks the VCM to the precinct listed on the test ballot. Also in the process, the clock of the machine is synced, the iButtons are associated with the certificate in the machines, and data from other precincts are deleted.
8. A test transmission is done to a local CCS over LAN. Transmission reports, diagnostic reports, and election returns are printed and sent to COMELEC.
9. The VCM is packed together with the data pack, network modules, and accessories then sent to the verification area.
10. The verifier checks that the SD card matches the ballot precinct number, inserts SD cards inside the machine and seals the slots with a blue zip-tie. The box containing everything is then sealed.
11. 10% of the machines for each municipal are selected for additional testing. If any of them fails, the entire batch is sent back for retesting and possible reconfiguration.

Aside: Write-Once Read-Many Storage Media
-----------------------------------------
The SD cards used have this feature that if a special command has been issued to it, it will go into read-only mode permanently. They’re called Write-Once-Read-Many (WORM) media.
The protocol is, after successful transmission, the BEI should tell the VCM to make the main SD card read-only. This is done at the last step because if any of the inserted SD card is read-only, the VCM will not be able to start up.

Network
-------

The devices are connected to the network by various means:
* For those with standard network coverage, 3G is used. Whichever network (Globe, Sun, or Smart) has the strongest signal in the area (an area survey is done prior, as well as data based on previous elections), that is selected.
* For the CCS in the municipals, mainly DSL is used. For locations with no DSL access, Satellite access is used.
* For VCM locations without access to 3G or DSL, Broadband Global Area Network (BGAN)  stations are used. 
* Overseas Absentee Voters have already cast their ballots, but the results have not yet been transmitted until on the election day itself. The results will be transmitted in embassies using BGANs.

The network is isolated from the internet and may only be accessed by using the special SIM card for 3G with a private APN, or over VPN. I’m not sure how the access goes over DSL, but I assume that it directly connects to the private network rather than to the internet.
